#!/bin/bash

source $HESTIA/func/main.sh
source $HESTIA/conf/hestia.conf

DATE=$(date)
DATECODE=$(date +"%F_%H%M")
USER=$(whoami)

clear
header_message() {
echo "*****************************************************"
echo "Hestia Control Panel Server Diagnostic Report"
echo "Version:          $VERSION"
echo "Release Branch:   $RELEASE_BRANCH"
echo "*****************************************************"
echo "Generated by Server:  $HOSTNAME"
echo "Generated by User:    $USER"
echo "Date Generated:       $DATE"
echo "*****************************************************"
echo ""
}

header_message
echo "Please wait while the diagnostic tool collects"
echo "output from system services and saved logs."
echo ""
echo "This may take a moment..."
echo ""
touch $HOME/hestiacp_diag_$DATECODE.log
header_message >> $HOME/hestiacp_diag_$DATECODE.log

for item in `ls $BIN/v-list-sys-*`; do
    echo "(*) Collecting data from $item..."
    bash $item >> $HOME/hestiacp_diag_$DATECODE.log
done
echo ""
echo "*****************************************************"
echo "Diagnostic report has been saved saved to:"
echo "$HOME/hestiacp_diag_$DATECODE.log"
echo "*****************************************************"
